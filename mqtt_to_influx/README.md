# **MQTT Client and InfluxDB Integration**

To handle time-series data from sensors transmitted via the MQTT protocol, we use **InfluxDB**, a time-series database optimized for large volumes of real-time data. InfluxDB offers efficient data storage and retrieval capabilities, making it suitable for IoT applications. Additionally, it integrates smoothly with monitoring tools and platforms like **Grafana**, enabling advanced data visualization and analysis.

### **Module Description**

This module functions as a **subscriber** within the **publish-subscribe (Pub-Sub)** model of MQTT. It listens to sensor data generated by our simulation framework and stores the measurements in an InfluxDB instance for further analysis.

### **Data Flow and Processing**

1. **Subscription to MQTT Topics**
   - The module subscribes to MQTT topics following the convention:  
     `+/sensors/#`
   - This pattern matches all sensor data topics defined by the simulator (e.g., `MSA1601/sensors/temp`, `MSA3500/sensors/co2`).

2. **Data Extraction**
   - Each received message contains:
     - The **topic**, which follows the format `{room_id}/sensors/{sensor_type}`.
     - The **message payload**, which includes:
       - **Value**: The sensor reading.
       - **Timestamp**: The time when the data point was generated.
   - The module parses the topic to extract:
     - `room_id`: The unique identifier for the room.
     - `sensor_type`: The type of sensor (e.g., temperature, humidity, COâ‚‚).

3. **Data Storage**
   - Parsed data is inserted into the `room_data` measurement in the InfluxDB instance using the `influxdb_client` Python package.
   - The data schema includes:
     - **Tag**: `room_id` (extracted from the topic).
     - **Fields**: A key-value pair where the key is `sensor_type` and the value is the sensor reading.
     - **Timestamp**: Derived from the message payload.

### **Example Workflow**

#### **Example Topic:**  
`MSA1601/sensors/temp`

#### **Example Message Payload:**  
```json
{
    "value": 22.5,
    "timestamp": "2025-02-02T14:15:00Z"
}
```

#### **Data Entry in InfluxDB:**
```plaintext
Measurement: room_data
Tags:
    room_id = MSA1601
Fields:
    temperature = 22.5
Timestamp:
    2025-02-02T14:15:00Z
```

### **Continuous Operation**

The subscriber runs indefinitely to ensure real-time data processing. This is achieved using the **`loop_forever()`** method from the **`paho.mqtt`** Python package. The method keeps the MQTT client in a continuous listening state, enabling it to handle incoming messages without interruption.

### Technical implementation
One-file Python script, which is constantly listening for updates on subscribed topics. Python packages used:
  - `influxdb_client`: For managing data insertion into InfluxDB.
  - `paho.mqtt`: For MQTT client operations and message handling.
